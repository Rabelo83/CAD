---
name: part-gen
description: Generate parametric 3D parts from a description and measurements. Creates OpenSCAD files for LEGO-style and mechanical parts, with optional CadQuery Python scripts for STEP export.
argument-hint: [description of the part with measurements]
allowed-tools:
  - Write
  - Edit
  - Read
  - Bash
---

# Parametric 3D Part Generator

You are generating a parametric 3D model based on the user's description and measurements.

## Workflow

1. **Parse the request**: Extract part description, dimensions (in mm), tolerances, and any reference details.
2. **Choose the approach**:
   - **OpenSCAD** (default): Best for geometric/mechanical parts, LEGO-style bricks, enclosures, brackets.
   - **CadQuery (Python)**: Use when the user needs native STEP export or more complex filleted/chamfered geometry.
3. **Generate the file(s)** in the project's `parts/<part-name>/` directory.
4. **Provide build instructions** for generating STL/STEP output.

## OpenSCAD File Standards

- All dimensions as named variables at the top of the file (parametric design).
- Use `$fn = 64;` for smooth curves (or higher for small details).
- Group related geometry with comments.
- Include a `// Print Settings` section with recommended layer height, infill, and orientation.
- Use modules for reusable sub-components.
- File naming: `<part_name>.scad`

### Template Structure

```openscad
// Part: <Part Name>
// Description: <what it is>
// Author: Generated by Claude Code
// Units: mm

// === Parameters ===
length = <value>;
width = <value>;
height = <value>;
wall_thickness = <value>;
tolerance = 0.2; // 3D print tolerance

// === Print Settings ===
// Layer height: 0.2mm
// Infill: 20%
// Supports: <yes/no>
// Orientation: <description>

// === Resolution ===
$fn = 64;

// === Modules ===
module part_name() {
    // geometry here
}

// === Assembly ===
part_name();
```

## CadQuery File Standards (when STEP export is needed)

- Python script using `cadquery` library.
- All dimensions as variables at the top.
- Export both STL and STEP.
- File naming: `<part_name>.py`

### Template Structure

```python
"""
Part: <Part Name>
Description: <what it is>
Units: mm
"""
import cadquery as cq

# === Parameters ===
length = <value>
width = <value>
height = <value>

# === Model ===
result = (
    cq.Workplane("XY")
    .box(length, width, height)
    # ... more operations
)

# === Export ===
cq.exporters.export(result, "<part_name>.stl")
cq.exporters.export(result, "<part_name>.step")
print(f"Exported <part_name>.stl and <part_name>.step")
```

## 3D Printing Tolerances

- Clearance fit (loose): +0.3mm per side
- Snap fit (tight): +0.1mm to +0.15mm per side
- Press fit: +0.05mm per side
- LEGO-style stud fit: use 0.1mm to 0.2mm clearance
- Hole diameter compensation: add +0.2mm to nominal diameter

## Output Checklist

- [ ] File created in `parts/<part-name>/` directory
- [ ] All dimensions parameterized (no magic numbers)
- [ ] Print settings documented in comments
- [ ] Build/export command provided to the user
- [ ] Tolerances applied where parts interface

## Build Commands

After generating the file, tell the user:

**OpenSCAD (CLI export to STL):**
```
openscad -o parts/<part-name>/<part_name>.stl parts/<part-name>/<part_name>.scad
```

**CadQuery (Python export):**
```
cd parts/<part-name> && python <part_name>.py
```

**Opening in Onshape:** Import the .step file directly. For .scad files, export to .step via FreeCAD or generate STL first.
